<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        @media print {
            body {
                background: white !important;
            }

            .no-print {
                display: none !important;
            }

            .print-invoice {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 20px !important;
            }
        }
    </style>
</head>

<body style="background: var(--gray-200);">
    <!-- Print Actions -->
    <div class="no-print" style="padding: 20px; text-align: center; background: var(--primary);">
        <button class="btn btn-primary" onclick="window.print()" style="background: white; color: var(--primary);">
            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        </button>
        <a href="invoices.html" class="btn btn-secondary" style="margin-right: 10px;">
            â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙÙˆØ§ØªÙŠØ±
        </a>
        <a href="new-invoice.html" class="btn btn-success" style="margin-right: 10px;">
            â• ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </a>
    </div>

    <!-- Invoice -->
    <div class="print-invoice" id="invoice">
        <!-- Header -->
        <div class="header" style="border-bottom: 3px solid var(--primary); padding-bottom: 20px;">
            <h1 id="invoiceStoreName" style="margin: 0;">Ø§Ù„Ù…Ø­Ù„</h1>
            <div style="display: flex; justify-content: center; gap: 30px; margin-top: 10px; color: var(--gray-600);">
                <span id="storePhone"></span>
                <span id="storeAddress"></span>
            </div>
        </div>

        <!-- Invoice Info -->
        <div class="info-row" style="margin-top: 20px;">
            <div class="info-item">
                <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                <span id="invoiceNumber">-</span>
            </div>
            <div class="info-item">
                <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                <span id="invoiceDate">-</span>
            </div>
            <div class="info-item">
                <label>Ø§Ù„ÙˆÙ‚Øª</label>
                <span id="invoiceTime">-</span>
            </div>
            <div class="info-item">
                <label>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                <span id="agentName">-</span>
            </div>
        </div>

        <!-- Customer Info -->
        <div id="customerSection"
            style="background: var(--gray-100); padding: 12px 20px; border-radius: 8px; margin-bottom: 20px;">
            <strong>Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> <span id="customerName">-</span>
        </div>

        <!-- Cancelled Badge -->
        <div id="cancelledBadge"
            style="display: none; background: var(--danger); color: white; padding: 10px 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-size: 18px;">
            âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù„ØºØ§Ø©
        </div>

        <!-- Items Table -->
        <table class="table" style="margin-bottom: 20px;">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody id="itemsTable">
            </tbody>
        </table>

        <!-- Summary -->
        <div class="invoice-summary">
            <div class="row">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                <span id="itemCount">0</span>
            </div>
            <div class="row total-row" style="font-size: 24px;">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                <span id="totalAmount">0 Ø¯.Ø¹</span>
            </div>
        </div>

        <!-- Notes -->
        <div id="notesSection"
            style="margin-top: 20px; padding: 15px; background: var(--gray-100); border-radius: 8px; display: none;">
            <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong>
            <p id="invoiceNotes" style="margin: 5px 0 0 0;"></p>
        </div>

        <!-- Footer -->
        <div style="margin-top: 40px; text-align: center; color: var(--gray-500); font-size: 14px;">
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
            <p id="footerPhone"></p>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        const urlParams = new URLSearchParams(window.location.search);
        const invoiceId = urlParams.get('id');

        if (!invoiceId) {
            window.location.href = 'invoices.html';
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function loadInvoice() {
            const invoice = App.getInvoiceById(invoiceId);

            if (!invoice) {
                alert('Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                window.location.href = 'invoices.html';
                return;
            }

            const settings = App.getSettings();

            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„
            document.getElementById('invoiceStoreName').textContent = settings.storeName;
            document.getElementById('storePhone').textContent = settings.phone ? `ğŸ“ ${settings.phone}` : '';
            document.getElementById('storeAddress').textContent = settings.address ? `ğŸ“ ${settings.address}` : '';
            document.getElementById('footerPhone').textContent = settings.phone || '';

            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            document.getElementById('invoiceNumber').textContent = invoice.invoiceNumber;

            const date = new Date(invoice.date);
            document.getElementById('invoiceDate').textContent = Utils.formatDate(date);
            document.getElementById('invoiceTime').textContent = date.toLocaleTimeString('ar-IQ', {
                hour: '2-digit',
                minute: '2-digit'
            });

            document.getElementById('agentName').textContent = settings.agentName || '-';

            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†
            if (invoice.customerName) {
                document.getElementById('customerName').textContent = invoice.customerName;
            } else {
                document.getElementById('customerSection').style.display = 'none';
            }

            // Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            if (invoice.status === 'cancelled') {
                document.getElementById('cancelledBadge').style.display = 'block';
            }

            // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const itemsTable = document.getElementById('itemsTable');
            itemsTable.innerHTML = invoice.items.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.productName}</td>
                    <td>${item.quantity}</td>
                    <td>${Utils.formatCurrency(item.salePrice)}</td>
                    <td>${Utils.formatCurrency(item.salePrice * item.quantity)}</td>
                </tr>
            `).join('');

            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            document.getElementById('itemCount').textContent = invoice.items.length;
            document.getElementById('totalAmount').textContent = Utils.formatCurrency(invoice.total);

            // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            if (invoice.notes) {
                document.getElementById('notesSection').style.display = 'block';
                document.getElementById('invoiceNotes').textContent = invoice.notes;
            }

            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            document.title = `ÙØ§ØªÙˆØ±Ø© ${invoice.invoiceNumber} - ${settings.storeName}`;
        }

        loadInvoice();
    </script>
</body>

</html>