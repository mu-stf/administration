<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฅุญุตุงุฆูุงุช - ูุธุงู ุฅุฏุงุฑุฉ ุงููุญู</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <h1>๐ช <span id="storeName">ูุธุงู ุฅุฏุงุฑุฉ ุงููุญู</span></h1>
        <div class="header-actions">
            <span id="currentDate"></span>
            <button class="btn" onclick="App.logout()">
                ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ
            </button>
        </div>
    </header>

    <div class="main-layout">
        <!-- Sidebar -->
        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <span class="icon">๐</span>
                        ููุญุฉ ุงูุชุญูู
                    </a>
                </li>
                <li class="nav-item">
                    <a href="new-invoice.html" class="nav-link">
                        <span class="icon">โ</span>
                        ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
                    </a>
                </li>
                <li class="nav-item">
                    <a href="invoices.html" class="nav-link">
                        <span class="icon">๐</span>
                        ุงูููุงุชูุฑ
                    </a>
                </li>
                <li class="nav-item">
                    <a href="products.html" class="nav-link">
                        <span class="icon">๐ฆ</span>
                        ุงูููุชุฌุงุช
                    </a>
                </li>
                <li class="nav-item">
                    <a href="customers.html" class="nav-link">
                        <span class="icon">๐ฅ</span>
                        ุงูุฒุจุงุฆู
                    </a>
                </li>
                <li class="nav-item">
                    <a href="supplies.html" class="nav-link">
                        <span class="icon">๐ฅ</span>
                        ุงูุชูุฑูุฏุงุช
                    </a>
                </li>
                <li class="nav-item">
                    <a href="statistics.html" class="nav-link active">
                        <span class="icon">๐</span>
                        ุงูุฅุญุตุงุฆูุงุช
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="icon">โ๏ธ</span>
                        ุงูุฅุนุฏุงุฏุงุช
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Filters -->
            <div class="card mb-3">
                <div class="card-header">
                    <h2>๐ ุงููุชุฑุฉ ุงูุฒูููุฉ</h2>
                </div>
                <div class="card-body">
                    <div class="filters-bar">
                        <button class="btn btn-primary" onclick="setPeriod('today')">ุงูููู</button>
                        <button class="btn btn-secondary" onclick="setPeriod('week')">ูุฐุง ุงูุฃุณุจูุน</button>
                        <button class="btn btn-secondary" onclick="setPeriod('month')">ูุฐุง ุงูุดูุฑ</button>
                        <button class="btn btn-secondary" onclick="setPeriod('year')">ูุฐู ุงูุณูุฉ</button>
                        <button class="btn btn-secondary" onclick="toggleCustomPeriod()">ูุชุฑุฉ ูุฎุตุตุฉ</button>
                    </div>
                    <div id="customPeriod" class="hidden" style="margin-top: 20px;">
                        <div class="d-flex gap-2" style="flex-wrap: wrap;">
                            <div class="form-group" style="flex: 1; min-width: 200px;">
                                <label for="startDate">ูู ุชุงุฑูุฎ</label>
                                <input type="date" id="startDate" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 200px;">
                                <label for="endDate">ุฅูู ุชุงุฑูุฎ</label>
                                <input type="date" id="endDate" class="form-control">
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button class="btn btn-success" onclick="applyCustomPeriod()">
                                    ุชุทุจูู
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">๐</div>
                    <div class="stat-info">
                        <h3 id="statInvoices">0</h3>
                        <p>ุนุฏุฏ ุงูููุงุชูุฑ</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">๐ฐ</div>
                    <div class="stat-info">
                        <h3 id="statSales">0 ุฏ.ุน</h3>
                        <p>ุฅุฌูุงูู ุงููุจูุนุงุช</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">๐ฆ</div>
                    <div class="stat-info">
                        <h3 id="statCost">0 ุฏ.ุน</h3>
                        <p>ุฅุฌูุงูู ุงูุชูููุฉ</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                        ๐
                    </div>
                    <div class="stat-info">
                        <h3 id="statProfit">0 ุฏ.ุน</h3>
                        <p>ุตุงูู ุงูุฑุจุญ</p>
                    </div>
                </div>
            </div>

            <!-- Top Products -->
            <div class="card" style="margin-top: 24px;">
                <div class="card-header">
                    <h2>๐ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>ุงูููุชุฌ</th>
                                    <th>ุงููููุฉ ุงููุจุงุนุฉ</th>
                                    <th>ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="topProductsTable">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">
                                        ูุง ุชูุฌุฏ ุจูุงูุงุช ูููุชุฑุฉ ุงููุญุฏุฏุฉ
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script>
        // ุญูุงูุฉ ุงูุตูุญุฉ
        if (!App.protectPage()) {
            throw new Error('Unauthorized');
        }

        let currentStartDate = null;
        let currentEndDate = null;

        // ุชุญููู ุงูุจูุงูุงุช
        function loadPage() {
            // ุชุญููู ุงุณู ุงููุญู
            const settings = App.getSettings();
            document.getElementById('storeName').textContent = settings.storeName;

            // ุนุฑุถ ุงูุชุงุฑูุฎ
            document.getElementById('currentDate').textContent = Utils.formatDate(new Date());

            // ุชุนููู ุงููุชุฑุฉ ุงูุงูุชุฑุงุถูุฉ (ุงูููู)
            setPeriod('today');
        }

        // ุชุนููู ุงููุชุฑุฉ
        function setPeriod(period) {
            const now = new Date();

            switch (period) {
                case 'today':
                    currentStartDate = Utils.getStartOfDay(now);
                    currentEndDate = Utils.getEndOfDay(now);
                    break;
                case 'week':
                    currentStartDate = new Date(now);
                    currentStartDate.setDate(now.getDate() - 7);
                    currentStartDate = Utils.getStartOfDay(currentStartDate);
                    currentEndDate = Utils.getEndOfDay(now);
                    break;
                case 'month':
                    currentStartDate = Utils.getStartOfMonth(now);
                    currentEndDate = Utils.getEndOfMonth(now);
                    break;
                case 'year':
                    currentStartDate = Utils.getStartOfYear(now);
                    currentEndDate = Utils.getEndOfYear(now);
                    break;
            }

            // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูููุชุฑ
            document.querySelectorAll('.filters-bar .btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            event.target.classList.remove('btn-secondary');
            event.target.classList.add('btn-primary');

            // ุฅุฎูุงุก ุงููุชุฑุฉ ุงููุฎุตุตุฉ
            document.getElementById('customPeriod').classList.add('hidden');

            // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
            updateStatistics();
        }

        // ุชุจุฏูู ุนุฑุถ ุงููุชุฑุฉ ุงููุฎุตุตุฉ
        function toggleCustomPeriod() {
            const customPeriod = document.getElementById('customPeriod');
            customPeriod.classList.toggle('hidden');

            // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูููุชุฑ
            document.querySelectorAll('.filters-bar .btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            event.target.classList.remove('btn-secondary');
            event.target.classList.add('btn-primary');
        }

        // ุชุทุจูู ุงููุชุฑุฉ ุงููุฎุตุตุฉ
        function applyCustomPeriod() {
            const startDateInput = document.getElementById('startDate').value;
            const endDateInput = document.getElementById('endDate').value;

            if (!startDateInput || !endDateInput) {
                Utils.showAlert('ูุฑุฌู ุชุญุฏูุฏ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ', 'danger');
                return;
            }

            currentStartDate = Utils.getStartOfDay(new Date(startDateInput));
            currentEndDate = Utils.getEndOfDay(new Date(endDateInput));

            if (currentStartDate > currentEndDate) {
                Utils.showAlert('ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุฌุจ ุฃู ูููู ูุจู ุชุงุฑูุฎ ุงูููุงูุฉ', 'danger');
                return;
            }

            updateStatistics();
        }

        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        function updateStatistics() {
            const stats = App.getStatistics(currentStartDate, currentEndDate);

            // ุชุญุฏูุซ ุงูุจุทุงูุงุช
            document.getElementById('statInvoices').textContent = stats.invoiceCount;
            document.getElementById('statSales').textContent = Utils.formatCurrency(stats.totalSales);
            document.getElementById('statCost').textContent = Utils.formatCurrency(stats.totalCost);
            document.getElementById('statProfit').textContent = Utils.formatCurrency(stats.profit);

            // ุชุญุฏูุซ ุฌุฏูู ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู
            displayTopProducts(stats.topProducts);
        }

        // ุนุฑุถ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู
        function displayTopProducts(topProducts) {
            const tbody = document.getElementById('topProductsTable');

            if (topProducts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted">
                            ูุง ุชูุฌุฏ ุจูุงูุงุช ูููุชุฑุฉ ุงููุญุฏุฏุฉ
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = topProducts.map((product, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${product.productName}</td>
                    <td class="stock-ok">${product.quantity}</td>
                    <td class="stock-ok">${Utils.formatCurrency(product.total)}</td>
                </tr>
            `).join('');
        }

        loadPage();
    </script>
</body>

</html>